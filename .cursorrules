# Laravel Modular & Documentation Rules for Quân

- **Ngôn ngữ**: Sử dụng tiếng Việt cho toàn bộ tài liệu, phản hồi và comment giải thích logic.
- **Môi trường**: Luôn sử dụng lệnh `sail` thay thế cho `php` khi thực thi công việc. Ví dụ: `sail artisan migrate`.
- **Cấu trúc Thư mục**: 
    - Luôn làm việc theo cấu trúc Modular tại `/app/Modules/`. 
    - Namespace phải khớp chính xác với cấu trúc thư mục (ví dụ: `App\Modules\Voter\Controllers`).
    - Ưu tiên tạo file mới trong module thay vì các thư mục mặc định của Laravel.
    - **Enums**: Mỗi module có thư mục `Enums/` chứa enum (trạng thái, loại, ...). Ví dụ: `Core/Enums/UserStatusEnum.php`, `Post/Enums/PostStatusEnum.php`. Enum dùng `rule()` và `values()` cho validation.

- **Module Chức năng Chuẩn**: 
    - Một module mới mặc định phải bao gồm các hàm: `stats`, `index`, `show`, `store`, `update`, `destroy`, `bulk delete`, `bulk update status`, `change status`, `export`, `import`.
    - **Bộ lọc index**: Luôn có tìm kiếm theo tên (hoặc trường chính), trạng thái (status), khoảng ngày tạo (từ ngày đến ngày — `created_at`), và sắp xếp theo `id`, `created_at`, `updated_at` cùng các trường thông tin khác phù hợp (ví dụ: `title`, `sort_order`, `view_count`).

- **Export**:
    - Khi export Excel, luôn xuất đầy đủ các trường thông tin giống danh sách index (Resource).
    - Các trường quan hệ (created_by, created_at, updated_by, updated_at, status, categories, ...) phải có trong export tương ứng index.

- **API Resource & Localization**:
    - Luôn sử dụng Resource để trả về dữ liệu API.
    - **Định dạng ngày tháng**: Trong Resource, bắt buộc chuyển đổi dữ liệu thời gian về định dạng Việt Nam:
        - Các trường chỉ có ngày (ví dụ: birthday): `d/m/Y`.
        - Các trường có cả giờ (ví dụ: created_at, updated_at): `H:i:s d/m/Y`.
    - Ví dụ: `'created_at' => $this->created_at->format('H:i:s d/m/Y')`.

- **Tài liệu & Thiết kế**:
    - **Tài liệu câu trả lời**: Lưu các giải thích kiến trúc hoặc giải pháp phức tạp vào `/docs/answer`.
    - **Tài liệu API**: Khi tạo/cập nhật Controller, phải cập nhật file Markdown tương ứng trong `/docs/api` (gồm: Method, Path, Request Body, Response mẫu).
    - **Database**: Cập nhật sơ đồ bảng vào `DATABASE_DESIGN.md` khi có Migration mới.
    - **Cấu trúc dự án**: Cập nhật thông tin chi tiết về tập tin, thư mục vào `STRUCTURE_DESIGN.md` khi có thay đổi.

- **Scribe (API documentation)**:
    - Khi tạo hoặc thay đổi Controller API, **bắt buộc** bổ sung PHPDoc cho Scribe để sinh tài liệu API (`sail artisan scribe:generate`).
    - **Trên class**: dùng `@group Tên nhóm` (ví dụ: `@group Core - User`) và mô tả ngắn chức năng của controller.
    - **Trên từng action (method)**:
        - Mô tả ngắn bằng tiếng Việt cho từng endpoint.
        - `@queryParam` cho tham số query (search, status, sort_by, sort_order, limit, from_date, to_date, ...): ghi rõ kiểu, mô tả, Example nếu cần.
        - `@urlParam` cho tham số trên đường dẫn (ví dụ: `{user}`, `{id}`): required/optional, mô tả, Example.
        - `@bodyParam` cho request body (POST/PUT/PATCH): tên trường, kiểu, required/optional, mô tả, Example.
        - `@response` hoặc `@responseField` khi cần mô tả response mẫu cụ thể.
    - Đồng bộ với chuẩn module: mỗi action (stats, index, show, store, update, destroy, bulkDestroy, bulkUpdateStatus, changeStatus, export, import) đều có block PHPDoc đầy đủ tham số.
    - Tham khảo style trong `app/Modules/Post/PostController.php` và `app/Modules/Post/PostCategoryController.php`.

- **Seed Permission (phân quyền)**:
    - Danh sách permission chuẩn nằm trong `database/seeders/PermissionSeeder.php` (mảng `PERMISSIONS`: resource => [actions]).
    - **Khi có thay đổi hoặc bổ sung chức năng**: thêm module mới (resource mới) hoặc thêm action mới vào controller (ví dụ: thêm action `duplicate`) thì **bắt buộc** cập nhật mảng permission trong PermissionSeeder cho đầy đủ (thêm resource hoặc thêm action vào resource tương ứng), sau đó chạy `sail artisan db:seed --class=PermissionSeeder` (hoặc migrate:fresh --seed) để đồng bộ quyền.
    - Định dạng permission: `{resource}.{action}` (resource trùng prefix API: users, permissions, roles, organizations, posts, post-categories).
    - **Guard**: Dùng guard 'web' cho cả web và API Sanctum (đồng bộ với Spatie Permission).
